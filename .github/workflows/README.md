# GitHub Actions å·¥ä½œæµ

æœ¬é¡¹ç›®åŒ…å«å¤šä¸ª GitHub Actions å·¥ä½œæµï¼Œç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯• WebSocket æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚

## å·¥ä½œæµåˆ—è¡¨

### 1. WebSocket Server & Clients Test (`test-websocket.yml`)

**è§¦å‘æ–¹å¼:**
- æ¨é€åˆ° `main`, `master`, `dev` åˆ†æ”¯
- å¯¹è¿™äº›åˆ†æ”¯çš„ Pull Request
- æ‰‹åŠ¨è§¦å‘ (workflow_dispatch)

**åŠŸèƒ½:**
- åœ¨å¤šä¸ª Python ç‰ˆæœ¬ (3.9, 3.10, 3.11) ä¸Šæµ‹è¯•
- å¯åŠ¨ 1 ä¸ª WebSocket Server
- å¯åŠ¨ N ä¸ª Client (é»˜è®¤ 3 ä¸ªï¼Œå¯æ‰‹åŠ¨æŒ‡å®š)
- éªŒè¯æ‰€æœ‰è¿›ç¨‹æ­£å¸¸è¿è¡Œ
- è‡ªåŠ¨æ¸…ç†è¿›ç¨‹

**æ‰‹åŠ¨è§¦å‘å‚æ•°:**
- `client_count`: å®¢æˆ·ç«¯æ•°é‡ (é»˜è®¤: 3)

**ä½¿ç”¨æ–¹æ³•:**
```bash
# è‡ªåŠ¨è§¦å‘ (push æˆ– PR)
git push origin main

# æ‰‹åŠ¨è§¦å‘
# 1. è¿›å…¥ GitHub ä»“åº“é¡µé¢
# 2. ç‚¹å‡» "Actions" æ ‡ç­¾
# 3. é€‰æ‹© "WebSocket Server & Clients Test"
# 4. ç‚¹å‡» "Run workflow"
# 5. è¾“å…¥å®¢æˆ·ç«¯æ•°é‡
```

### 2. Custom Client Count Test (`test-with-custom-clients.yml`)

**è§¦å‘æ–¹å¼:**
- ä»…æ”¯æŒæ‰‹åŠ¨è§¦å‘ (workflow_dispatch)

**åŠŸèƒ½:**
- å¯åŠ¨ 1 ä¸ª WebSocket Server
- å¯åŠ¨æŒ‡å®šæ•°é‡çš„ Client (1, 2, 3, 5, 10)
- ä½¿ç”¨æŒ‡å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥
- æŒç»­ç›‘æ§ 20 ç§’
- æ˜¾ç¤ºè¯¦ç»†çš„è¿è¡ŒçŠ¶æ€
- ç”Ÿæˆæµ‹è¯•æ‘˜è¦

**æ‰‹åŠ¨è§¦å‘å‚æ•°:**
- `client_count`: å®¢æˆ·ç«¯æ•°é‡ (é€‰é¡¹: 1, 2, 3, 5, 10)
- `load_balancing_strategy`: è´Ÿè½½å‡è¡¡ç­–ç•¥
  - `least_loaded`: è´Ÿè½½æœ€å°ä¼˜å…ˆ
  - `round_robin`: è½®è¯¢
  - `weighted_random`: åŠ æƒéšæœº
  - `random`: éšæœº

**ä½¿ç”¨æ–¹æ³•:**
```bash
# 1. è¿›å…¥ GitHub ä»“åº“é¡µé¢
# 2. ç‚¹å‡» "Actions" æ ‡ç­¾
# 3. é€‰æ‹© "Custom Client Count Test"
# 4. ç‚¹å‡» "Run workflow"
# 5. é€‰æ‹©:
#    - å®¢æˆ·ç«¯æ•°é‡ (å¦‚: 5)
#    - è´Ÿè½½å‡è¡¡ç­–ç•¥ (å¦‚: least_loaded)
# 6. ç‚¹å‡» "Run workflow" ç¡®è®¤
```

## å·¥ä½œæµç‰¹æ€§

### âœ… è‡ªåŠ¨åŒ–æµ‹è¯•
- è‡ªåŠ¨å®‰è£…ä¾èµ– (websockets)
- è‡ªåŠ¨å¯åŠ¨ server å’Œå¤šä¸ª clients
- è‡ªåŠ¨éªŒè¯è¿›ç¨‹çŠ¶æ€
- è‡ªåŠ¨æ¸…ç†æ‰€æœ‰è¿›ç¨‹

### ğŸ“Š ç›‘æ§ä¸æŠ¥å‘Š
- å®æ—¶æ˜¾ç¤ºè¿›ç¨‹å¯åŠ¨çŠ¶æ€
- å‘¨æœŸæ€§æ£€æŸ¥è¿›ç¨‹å¥åº·çŠ¶æ€
- ç”Ÿæˆæµ‹è¯•æ‘˜è¦ (GitHub Summary)
- æ˜¾ç¤ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯

### ğŸ›¡ï¸ é”™è¯¯å¤„ç†
- è¶…æ—¶ä¿æŠ¤ (10 åˆ†é’Ÿ)
- è¿›ç¨‹å¼‚å¸¸æ£€æµ‹
- è‡ªåŠ¨æ¸…ç†æ®‹ç•™è¿›ç¨‹ (always cleanup)
- é”™è¯¯ä¿¡æ¯è¯¦ç»†è¾“å‡º

### ğŸ”§ çµæ´»é…ç½®
- å¯è‡ªå®šä¹‰å®¢æˆ·ç«¯æ•°é‡
- å¯é€‰æ‹©è´Ÿè½½å‡è¡¡ç­–ç•¥
- æ”¯æŒå¤š Python ç‰ˆæœ¬æµ‹è¯•
- æ”¯æŒæ‰‹åŠ¨å’Œè‡ªåŠ¨è§¦å‘

## æµ‹è¯•æµç¨‹

### æ ‡å‡†æµ‹è¯•æµç¨‹ (test-websocket.yml)
```
1. Checkout ä»£ç 
2. è®¾ç½® Python ç¯å¢ƒ
3. å®‰è£…ä¾èµ– (websockets)
4. å¯åŠ¨ Server (åå°è¿è¡Œ)
5. å¯åŠ¨ N ä¸ª Clients (åå°è¿è¡Œ)
6. ç­‰å¾…è¿æ¥å»ºç«‹ (5 ç§’)
7. éªŒè¯æ‰€æœ‰è¿›ç¨‹è¿è¡Œæ­£å¸¸
8. æ¸…ç†æ‰€æœ‰è¿›ç¨‹
```

### è‡ªå®šä¹‰æµ‹è¯•æµç¨‹ (test-with-custom-clients.yml)
```
1. Checkout ä»£ç 
2. è®¾ç½® Python 3.11
3. å®‰è£…ä¾èµ–
4. åˆ›å»ºç¼–æ’è„šæœ¬ (orchestrator.py)
5. ä¿®æ”¹ server.py è´Ÿè½½å‡è¡¡ç­–ç•¥
6. å¯åŠ¨ Server
7. å¯åŠ¨ N ä¸ª Clients
8. ç›‘æ§ 20 ç§’ (æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€)
9. ç”Ÿæˆæµ‹è¯•æ‘˜è¦
10. æ¸…ç†æ‰€æœ‰è¿›ç¨‹
```

## ç›‘æ§è¾“å‡ºç¤ºä¾‹

```
ğŸš€ å¯åŠ¨ WebSocket Server...
   è´Ÿè½½å‡è¡¡ç­–ç•¥: least_loaded
  âœ… Server PID: 1234

ğŸš€ å¯åŠ¨ 5 ä¸ª Clients...
  âœ… Client #1 PID: 1235
  âœ… Client #2 PID: 1236
  âœ… Client #3 PID: 1237
  âœ… Client #4 PID: 1238
  âœ… Client #5 PID: 1239

â³ ç­‰å¾…è¿æ¥å»ºç«‹...

â±ï¸  ç›‘æ§è¿è¡ŒçŠ¶æ€ (20 ç§’)...
  ğŸ“Š Server: è¿è¡Œä¸­ | Clients: 5/5 æ´»è·ƒ
  ğŸ“Š Server: è¿è¡Œä¸­ | Clients: 5/5 æ´»è·ƒ
  ğŸ“Š Server: è¿è¡Œä¸­ | Clients: 5/5 æ´»è·ƒ
  ğŸ“Š Server: è¿è¡Œä¸­ | Clients: 5/5 æ´»è·ƒ

âœ… æµ‹è¯•æˆåŠŸå®Œæˆ

ğŸ§¹ æ¸…ç†æ‰€æœ‰è¿›ç¨‹...
  åœæ­¢ Client #1
  åœæ­¢ Client #2
  åœæ­¢ Client #3
  åœæ­¢ Client #4
  åœæ­¢ Client #5
  åœæ­¢ Server
âœ… æ¸…ç†å®Œæˆ
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜: Server å¯åŠ¨å¤±è´¥
**è§£å†³æ–¹æ¡ˆ:**
- æ£€æŸ¥ç«¯å£ 8765 æ˜¯å¦è¢«å ç”¨
- æŸ¥çœ‹ Server æ—¥å¿—è¾“å‡º
- ç¡®è®¤ server.py è¯­æ³•æ­£ç¡®

### é—®é¢˜: Client æ— æ³•è¿æ¥
**è§£å†³æ–¹æ¡ˆ:**
- å¢åŠ ç­‰å¾…æ—¶é—´ (ä¿®æ”¹ sleep æ—¶é•¿)
- æ£€æŸ¥ç½‘ç»œé…ç½®
- ç¡®è®¤ Server å·²æ­£å¸¸å¯åŠ¨

### é—®é¢˜: è¿›ç¨‹æœªæ¸…ç†
**è§£å†³æ–¹æ¡ˆ:**
- ä½¿ç”¨ `if: always()` ç¡®ä¿æ¸…ç†æ­¥éª¤æ‰§è¡Œ
- æ·»åŠ  `kill -9` å¼ºåˆ¶ç»ˆæ­¢
- å¢åŠ æ¸…ç†ç­‰å¾…æ—¶é—´

## æœ€ä½³å®è·µ

1. **æµ‹è¯•å‰æäº¤ä»£ç **: ç¡®ä¿ä»£ç å·²æäº¤åˆ°ä»“åº“
2. **é€‰æ‹©åˆé€‚çš„å®¢æˆ·ç«¯æ•°é‡**: æ ¹æ®æµ‹è¯•ç›®çš„é€‰æ‹© 1-10 ä¸ª
3. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**: å±•å¼€æ‰€æœ‰æ­¥éª¤æŸ¥çœ‹è¯¦ç»†è¾“å‡º
4. **å®šæœŸè¿è¡Œ**: åœ¨ä»£ç å˜æ›´åè¿è¡Œå®Œæ•´æµ‹è¯•
5. **ç›‘æ§èµ„æº**: æ³¨æ„ GitHub Actions çš„ä½¿ç”¨é…é¢

## é…é¢è¯´æ˜

GitHub Actions å…è´¹é…é¢:
- **Public ä»“åº“**: æ— é™åˆ¶
- **Private ä»“åº“**: 2000 åˆ†é’Ÿ/æœˆ (å…è´¹è´¦æˆ·)

æ¯æ¬¡è¿è¡Œæ—¶é—´:
- æ ‡å‡†æµ‹è¯•: ~3-5 åˆ†é’Ÿ
- è‡ªå®šä¹‰æµ‹è¯•: ~5-8 åˆ†é’Ÿ

## æ‰©å±•å»ºè®®

### æ·»åŠ æ›´å¤šæµ‹è¯•åœºæ™¯
```yaml
- name: Test error recovery
  run: |
    python test_error_decay.py

- name: Test load balancing
  run: |
    python test_example.py
```

### æ·»åŠ æ€§èƒ½æµ‹è¯•
```yaml
- name: Performance test
  run: |
    # è¿è¡Œ 100 æ¬¡è¯·æ±‚
    for i in {1..100}; do
      # å‘é€æµ‹è¯•è¯·æ±‚
    done
```

### æ·»åŠ é€šçŸ¥
```yaml
- name: Notify on failure
  if: failure()
  uses: actions/slack-notify@v1
  with:
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

## æ€»ç»“

è¿™äº› GitHub Actions å·¥ä½œæµæä¾›äº†:
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹
- âœ… å¤šåœºæ™¯æµ‹è¯•è¦†ç›–
- âœ… çµæ´»çš„é…ç½®é€‰é¡¹
- âœ… è¯¦ç»†çš„ç›‘æ§å’ŒæŠ¥å‘Š
- âœ… å¯é çš„é”™è¯¯å¤„ç†

é€šè¿‡è¿™äº›å·¥ä½œæµï¼Œæ‚¨å¯ä»¥ç¡®ä¿ WebSocket æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åœ¨å„ç§é…ç½®ä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚
